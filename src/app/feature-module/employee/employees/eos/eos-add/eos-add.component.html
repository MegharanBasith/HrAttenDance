<div class="form-container">
    <p-toast></p-toast>

    <div *ngIf="showSpinner">
        <app-spinner></app-spinner>
    </div>
    <form [formGroup]="eosForm" class="vacation-form">
        <div class="card custom-card">
            <div class="card-header border-bottom-0 justify-content-between">
                <div class="card-title">{{ 'eos.addeos' | translate }}</div>
                <a href="javascript:void(0);" data-bs-toggle="collapse" data-bs-target="#eosDetails"
                    aria-expanded="false" aria-controls="collapseExample">
                    <i class="feather icon-chevron-down fs-18 collapse-open"></i>
                    <i class="feather icon-chevron-up collapse-close fs-18"></i>
                </a>
            </div>
            <div class="collapse show border-top" id="eosDetails">
                <div class="card-body">

                    <div class="row">
                        <div class="col-sm-6">
                            <app-employee-filter [employeeControl]="employeeControl">
                            </app-employee-filter>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3 toggle-container">
                                <label class="col-form-label" for="">{{'eos.calculateForThisMonthOnly'|
                                    translate}}</label>
                                <mat-slide-toggle class="toggle-button custom-mat-toggle"
                                    formControlName="calculateForThisMonthOnly" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="">{{'eos.eosType'| translate}}</label><span
                                    class="text-danger">*</span>
                                <mat-select class="custom-mat-select"
                                    [class.invalid]="eosForm.get('eosTypeId')?.invalid && eosForm.get('eosTypeId')?.touched"
                                    formControlName="eosTypeId" placeholder="{{'select'| translate}}">
                                    <mat-option *ngFor="let option of eosTypeId" [value]="option.Id">
                                        {{ option.EnglishName }}
                                    </mat-option>
                                </mat-select>

                                @if (eosForm.get('eosTypeId')?.invalid && eosForm.get('eosTypeId')?.touched) {
                                <div>
                                    @if (eosForm.get('eosTypeId')?.invalid && eosForm.get('eosTypeId')?.touched)
                                    {
                                    <small class="text-danger"> {{'eos.eosTypeRequired'| translate}}</small>
                                    }
                                </div>
                                }
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="">{{'eos.EmpStatus'| translate}}</label><span
                                    class="text-danger">*</span>
                                <mat-select class="custom-mat-select"
                                    [class.invalid]="eosForm.get('EmpStatus')?.invalid && eosForm.get('EmpStatus')?.touched"
                                    formControlName="EmpStatus" placeholder="{{'select'| translate}}">
                                    <mat-option *ngFor="let option of EmpStatus" [value]="option">
                                        {{ option }}
                                    </mat-option>
                                </mat-select>

                                @if (eosForm.get('EmpStatus')?.invalid && eosForm.get('EmpStatus')?.touched) {
                                <div>
                                    @if (eosForm.get('EmpStatus')?.invalid && eosForm.get('EmpStatus')?.touched)
                                    {
                                    <small class="text-danger"> {{'eos.empStatusRequired'| translate}}</small>
                                    }
                                </div>
                                }
                            </div>
                        </div>
                        <!-- <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="">{{'leave.paymentMethod'| translate}}</label>
                                <mat-select class="custom-mat-select" formControlName="paymentMethod"
                                    placeholder="{{'select'| translate}}">
                                    <mat-option *ngFor="let option of paymentMethodOptions" [value]="option">
                                        {{ option }}
                                    </mat-option>
                                </mat-select>

                            </div>
                        </div> -->

                    </div>
                    <div class="row">
                        <div class="col-3">
                            <div class="input-block mb-3 date-input1">
                                <label class="col-form-label" for="">{{'eos.eosDate'| translate}}<span
                                        class="text-danger">*</span></label>
                                <div class="cal-icon">
                                    <input class="form-control datetimepicker" type="text" bsDatepicker type="text"
                                        container=".date-input1" (ngModelChange)="calculateEndDays()"
                                        [class.invalid]="eosForm.get('eosDate')?.invalid && eosForm.get('eosDate')?.touched"
                                        formControlName="eosDate">
                                    @if (eosForm.get('eosDate')?.invalid && eosForm.get('eosDate')?.touched) {
                                    <div>
                                        @if (eosForm.get('eosDate')?.invalid && eosForm.get('eosDate')?.touched)
                                        {
                                        <small class="text-danger"> {{'leave.eosDateRequired'| translate}}</small>
                                        }
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <!-- <div class="col-sm-6">
                            <div class="input-block mb-3 date-input1">
                                <label class="col-form-label" for="">{{'leave.startDate'| translate}}<span
                                        class="text-danger">*</span></label>
                                <div class="cal-icon">
                                    <input class="form-control datetimepicker" type="text" bsDatepicker type="text"
                                        container=".date-input1"
                                        [class.invalid]="eosForm.get('startDate')?.invalid && eosForm.get('startDate')?.touched"
                                        formControlName="startDate">
                                    @if (eosForm.get('startDate')?.invalid && eosForm.get('startDate')?.touched) {
                                    <div>
                                        @if (eosForm.get('startDate')?.invalid && eosForm.get('startDate')?.touched)
                                        {
                                        <small class="text-danger"> {{'leave.startDateRequired'| translate}}</small>
                                        }
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>-->
                        <div class="col-3">
                            <div class="input-block mb-3 date-input1">
                                <label class="col-form-label" for="">{{'leave.endDate'| translate}}<span
                                        class="text-danger">*</span></label>
                                <div class="cal-icon">
                                    <input class="form-control datetimepicker" type="text" bsDatepicker type="text"
                                        container=".date-input1"
                                        [class.invalid]="eosForm.get('endDate')?.invalid && eosForm.get('endDate')?.touched"
                                        formControlName="endDate">
                                    @if (eosForm.get('endDate')?.invalid && eosForm.get('endDate')?.touched) {
                                    <div>
                                        @if (eosForm.get('endDate')?.invalid && eosForm.get('endDate')?.touched)
                                        {
                                        <small class="text-danger"> {{'leave.endDateRequired'| translate}}</small>
                                        }
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="input-block mb-3 date-input1">
                                <label class="col-form-label" for="">{{'eos.actualDate'| translate}}<span
                                        class="text-danger">*</span></label>
                                <div class="cal-icon">
                                    <input class="form-control datetimepicker" type="text" bsDatepicker type="text"
                                        container=".date-input1"
                                        [class.invalid]="eosForm.get('ActualEndDate')?.invalid && eosForm.get('ActualEndDate')?.touched"
                                        formControlName="ActualEndDate">
                                    @if (eosForm.get('ActualEndDate')?.invalid && eosForm.get('ActualEndDate')?.touched)
                                    {
                                    <div>
                                        @if (eosForm.get('ActualEndDate')?.invalid &&
                                        eosForm.get('ActualEndDate')?.touched)
                                        {
                                        <small class="text-danger"> {{'leave.actualEndDateRequired'| translate}}</small>
                                        }
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="vacation-form">
        <div class="card custom-card">
            <div class="card-header border-bottom-0 justify-content-between">
                <div class="card-title">{{ 'eos.addEarnings' | translate }}</div>
                <a href="javascript:void(0);" data-bs-toggle="collapse" data-bs-target="#addEarnings"
                    aria-expanded="false" aria-controls="collapseExample">
                    <i class="feather icon-chevron-down fs-18 collapse-open"></i>
                    <i class="feather icon-chevron-up collapse-close fs-18"></i>
                </a>
            </div>
            <div class="collapse show border-top" id="addEarnings">
                <div class="card-body">
                    <div class="col-auto ms-auto add-btn-container">
                        <button class="btn btn-success" (click)="onAddEarning()">
                            <mat-icon class="custom-mat-icon">add</mat-icon>
                            {{'add' | translate}}
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table mat-table [dataSource]="earningDataSource" matSort
                            class="table table-striped custom-table mb-0 datatable">
                            <thead>
                                <ng-container *ngFor="let column of columns" [matColumnDef]="column">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> {{
                                        'eos.' + column | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let element"> {{ element[column] }} </td>
                                </ng-container>
                                <ng-container matColumnDef="actions">
                                    <th mat-header-cell *matHeaderCellDef> Actions </th>
                                    <td mat-cell *matCellDef="let row">
                                        <button mat-icon-button (click)="deleteRecord(row)" class="icon-btn">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </td>
                                </ng-container>

                            </thead>
                            <tbody>
                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                            </tbody>
                        </table>
                    </div>
                    <p-dialog header="{{'eos.addEarnings' | translate}}" [(visible)]="showEarningDialog" [modal]="true"
                        [style]="{ width: '40rem' }" [closable]="true">
                        <form [formGroup]="earnForm">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="input-block mb-3">
                                        <label class="col-form-label" for="">{{'eos.earnType'| translate}}<span
                                                class="text-danger">*</span></label>
                                        <mat-select class="custom-mat-select"
                                            [class.invalid]="earnForm.get('type')?.invalid && earnForm.get('type')?.touched"
                                            formControlName="type" placeholder="{{'select'| translate}}">
                                            <mat-option *ngFor="let option of earnList" [value]="option.id">
                                                {{ option.description }}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="earnForm.controls['type']?.touched && earnForm.controls['type']?.errors?.['required']">
                                            <small class="text-danger"> {{'eos.earnTypeRequired' | translate }}</small>
                                        </mat-error>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="input-block mb-3">
                                        <label class="col-form-label" for="">{{'eos.amount'| translate}}<span
                                                class="text-danger">*</span></label>
                                        <input type="number" class="form-control"
                                            [class.invalid]="earnForm.get('amount')?.invalid && earnForm.get('amount')?.touched"
                                            formControlName="amount">
                                        <mat-error
                                            *ngIf="earnForm.controls['amount']?.touched && earnForm.controls['amount']?.errors?.['required']">
                                            <small class="text-danger"> {{'eos.amountRequired' | translate }}</small>
                                        </mat-error>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-block mb-3">
                                    <label class="col-form-label" for="">{{'eos.notes'| translate}}</label>
                                    <input type="text" class="form-control"
                                        [class.invalid]="earnForm.get('notes')?.invalid && earnForm.get('notes')?.touched"
                                        formControlName="notes">
                                </div>
                            </div>
                        </form>
                        <ng-template pTemplate="footer">
                            <div class="add-dialog-btn-container">
                                <button class="btn btn-primary" type="submit" [disabled]="earnForm.invalid"
                                    (click)="addRecord(earnForm, earnList, earnTransType)"> {{'add' |
                                    translate}}</button>
                            </div>
                        </ng-template>
                    </p-dialog>
                </div>
            </div>
        </div>
    </div>
    <div class="vacation-form">
        <div class="card custom-card">
            <div class="card-header border-bottom-0 justify-content-between">
                <div class="card-title">{{ 'eos.addDeductions' | translate }}</div>
                <a href="javascript:void(0);" data-bs-toggle="collapse" data-bs-target="#addDeductions"
                    aria-expanded="false" aria-controls="collapseExample">
                    <i class="feather icon-chevron-down fs-18 collapse-open"></i>
                    <i class="feather icon-chevron-up collapse-close fs-18"></i>
                </a>
            </div>
            <div class="collapse show border-top" id="addDeductions">
                <div class="card-body">
                    <div class="col-auto ms-auto add-btn-container">
                        <button class="btn btn-warning" (click)="onAddingDeduction()">
                            <mat-icon class="custom-mat-icon">add</mat-icon>
                            {{'add' | translate}}
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table mat-table [dataSource]="deductionDataSource" matSort
                            class="table table-striped custom-table mb-0 datatable">
                            <thead>
                                <ng-container *ngFor="let column of columns" [matColumnDef]="column">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> {{
                                        'eos.' + column | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let element"> {{ element[column] }} </td>
                                </ng-container>
                                <ng-container matColumnDef="actions">
                                    <th mat-header-cell *matHeaderCellDef> Actions </th>
                                    <td mat-cell *matCellDef="let row">
                                        <button mat-icon-button (click)="deleteRecord(row)" class="icon-btn">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </td>
                                </ng-container>
                            </thead>
                            <tbody>
                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                            </tbody>
                        </table>
                    </div>
                    <p-dialog header="{{'eos.addDeductions' | translate}}" [(visible)]="showDeductionDialog"
                        [modal]="true" [style]="{ width: '40rem' }" [closable]="true">
                        <form [formGroup]="deductionForm">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="input-block mb-3">
                                        <label class="col-form-label" for="">{{'eos.deductionType'| translate}}<span
                                                class="text-danger">*</span></label>
                                        <mat-select class="custom-mat-select"
                                            [class.invalid]="deductionForm.get('type')?.invalid && deductionForm.get('type')?.touched"
                                            formControlName="type" placeholder="{{'select'| translate}}">
                                            <mat-option *ngFor="let option of deductList" [value]="option.id">
                                                {{ option.description }}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="deductionForm.controls['type']?.touched && deductionForm.controls['type']?.errors?.['required']">
                                            <small class="text-danger"> {{'eos.deductionTypeRequired' | translate
                                                }}</small>
                                        </mat-error>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="input-block mb-3">
                                        <label class="col-form-label" for="">{{'eos.amount'| translate}}<span
                                                class="text-danger">*</span></label>
                                        <input type="number" class="form-control"
                                            [class.invalid]="deductionForm.get('amount')?.invalid && deductionForm.get('amount')?.touched"
                                            formControlName="amount">
                                        <mat-error
                                            *ngIf="deductionForm.controls['amount']?.touched && deductionForm.controls['amount']?.errors?.['required']">
                                            <small class="text-danger"> {{'eos.amountRequired' | translate }}</small>
                                        </mat-error>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-block mb-3">
                                    <label class="col-form-label" for="">{{'eos.notes'| translate}}</label>
                                    <input type="text" class="form-control"
                                        [class.invalid]="deductionForm.get('notes')?.invalid && deductionForm.get('notes')?.touched"
                                        formControlName="notes">
                                </div>
                            </div>
                        </form>
                        <ng-template pTemplate="footer">
                            <div class="add-dialog-btn-container">
                                <button class="btn btn-primary" type="submit" [disabled]="deductionForm.invalid"
                                    (click)="addRecord(deductionForm, deductList, deductionTransType)"> {{'add' |
                                    translate}}</button>
                            </div>
                        </ng-template>
                    </p-dialog>
                </div>
            </div>
        </div>
    </div>
    <div class="submit-container">
        <button class="btn btn-primary submit-button" [disabled]="eosForm.invalid" (click)="onSubmit()">{{'submit'
            | translate
            }}</button>
    </div>
</div>